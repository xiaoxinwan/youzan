{"version":3,"sources":["webpack:///./src/modules/js/api.js","webpack:///./src/modules/js/mixin.js","webpack:///./src/modules/js/cartService.js","webpack:///./src/pages/cart/cart.js","webpack:///./src/modules/js/fetch.js"],"names":["url","hotLists","banner","topList","subList","rank","searchList","goodsDetails","goodsDeal","goodsEvaluation","addCart","updateCart","cartlist","reduceCart","removeCart","mremoveCart","addAddress","removeAddress","addressList","updateAddress","setDefaultAddress","key","hasOwnProperty","mixin","filters","currency","value","parseFloat","toFixed","Cart","id","fetch","number","qs","parse","location","search","substr","Vue","el","mixins","data","cartlists","total","totalNum","editingShop","editingShopIndex","removePopup","removeData","removeMsg","computed","allSelected","get","this","length","every","shop","checked","set","newVal","forEach","goodsList","good","allRemoveSelected","removeChecked","selectLists","arr","push","price","removeLists","created","getList","methods","_this","then","res","lists","cartList","editing","editingMsg","selectGood","attr","selectShop","selectAll","edit","shopIndex","item","i","reduce","add","remove","goodIndex","removeList","removeConfirm","_this2","_removeData","splice","resetShop","ids","findIndex","cancel","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default","a","resolve","reject","axios","post","status","href","catch","error"],"mappings":"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","file":"static/js/cart.42c2c60968b5b58f49bd.js","sourcesContent":["let url = {\n    hotLists: '/index/hotLists',\n    banner: '/index/banner',\n    topList: '/category/topList',\n    subList: '/category/subList',\n    rank: '/category/rank',\n    searchList: '/search/list',\n    goodsDetails: '/goods/details',\n    goodsDeal: '/goods/deal',\n    goodsEvaluation: '/goods/evaluation',\n    addCart: '/cart/add',\n    updateCart: '/cart/update',\n    cartlist: '/cart/list',\n    reduceCart: '/cart/reduce',\n    removeCart: '/cart/remove',\n    mremoveCart: '/cart/mremove',\n    addAddress: '/address/add',\n    removeAddress: '/address/remove',\n    addressList: '/address/list',\n    updateAddress: '/address/update',\n    setDefaultAddress: '/address/setDefault'\n}\n\n// 开发环境和真实环境的切换\nlet host = 'https://www.easy-mock.com/mock/5c3be71133a2af207aa9adec/youzan'\n\nfor (let key in url) {\n    if (url.hasOwnProperty(key)) {\n        url[key] = host + url[key]\n    }\n}\n\nexport default url\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/api.js","let mixin = {\n  filters: {\n    currency: function(value) {\n      return parseFloat(value).toFixed(2);\n    }\n  }\n};\nexport default mixin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/mixin.js","import fetch from 'js/fetch.js'\nimport url from 'js/api.js'\n\n\nclass Cart {\n  static add(id){\n    return fetch(url.addCart,{\n      id: id,\n      number: 1\n    })\n  }\n\n  static reduce(id){\n    return fetch(url.reduceCart, {\n      id: id,\n      number: 1\n    })\n  }\n}\n\nexport default Cart\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/cartService.js","import \"./cart_base.css\";\nimport \"./cart_trade.css\";\nimport \"./cart.css\";\n\nimport Vue from \"vue\";\nimport url from 'js/api.js'\nimport mixin from \"js/mixin.js\";\nimport qs from \"qs\";\nimport Cart from \"js/cartService.js\";\nimport fetch from 'js/fetch.js'\n\n\nlet { id } = qs.parse(location.search.substr(1));\nnew Vue({\n  el: \".container\",\n  mixins: [mixin],\n  data: {\n    cartlists: null,\n    total: 0,\n    totalNum: 0,\n    editingShop: null,\n    editingShopIndex: -1,\n    removePopup: false,\n    removeData: null,\n    removeMsg: \"\"\n  },\n  computed: {\n    allSelected: {\n      get() {\n        if (this.cartlists && this.cartlists.length) {\n          return this.cartlists.every(shop => {\n            return shop.checked;\n          });\n        }\n        return false;\n      },\n      set(newVal) {\n        this.cartlists.forEach(shop => {\n          shop.checked = newVal;\n          shop.goodsList.forEach(good => {\n            good.checked = newVal;\n          });\n        });\n      }\n    },\n    allRemoveSelected: {\n      get() {\n        if (this.editingShop) {\n          return this.editingShop.removeChecked;\n        }\n        return false;\n      },\n      set(newVal) {\n        if (this.editingShop) {\n          this.editingShop.removeChecked = newVal;\n          this.editingShop.goodsList.forEach(good => {\n            good.removeChecked = newVal;\n          });\n        }\n      }\n    },\n    selectLists() {\n      if (this.cartlists && this.cartlists.length) {\n        let totalNum = 0;\n        let total = 0;\n        let arr = [];\n        this.cartlists.forEach(shop => {\n          shop.goodsList.forEach(good => {\n            if (good.checked) {\n              arr.push(good);\n              totalNum += good.number;\n              total += good.price * good.number;\n            }\n          });\n        });\n        this.totalNum = totalNum;\n        this.total = total;\n        return arr;\n      }\n      return [];\n    },\n    removeLists() {\n      if (this.editingShop) {\n        let arr = [];\n        this.editingShop.goodsList.forEach(good => {\n          if (good.removeChecked) {\n            arr.push(good);\n          }\n        });\n        return arr;\n      }\n      return [];\n    }\n  },\n  created() {\n    this.getList();\n  },\n  methods: {\n    getList() {\n      fetch(url.cartlist).then(res => {\n        let lists = res.data.cartList;\n        lists.forEach(shop => {\n          shop.checked = true;\n          shop.editing = false;\n          shop.editingMsg = \"编辑\";\n          shop.removeChecked = false;\n          shop.goodsList.forEach(good => {\n            good.checked = true;\n            good.removeChecked = false;\n          });\n        });\n        this.cartlists = lists;\n      });\n    },\n    selectGood(shop, good) {\n      let attr = this.editingShop ? \"removeChecked\" : \"checked\";\n      good[attr] = !good[attr];\n      shop[attr] = shop.goodsList.every(good => {\n        return good[attr];\n      });\n    },\n    selectShop(shop) {\n      let attr = this.editingShop ? \"removeChecked\" : \"checked\";\n      shop[attr] = !shop[attr];\n      shop.goodsList.forEach(good => {\n        good[attr] = shop[attr];\n      });\n    },\n    selectAll() {\n      let attr = this.editingShop ? \"allRemoveSelected\" : \"allSelected\";\n      this[attr] = !this[attr];\n    },\n    edit(shop, shopIndex) {\n      shop.editing = !shop.editing;\n      shop.editingMsg = shop.editing ? \"完成\" : \"编辑\";\n      this.cartlists.forEach((item, i) => {\n        if (shopIndex !== i) {\n          item.editing = false;\n          item.editingMsg = shop.editing ? \"\" : \"编辑\";\n        }\n      });\n      this.editingShop = shop.editing ? shop : null;\n      this.editingShopIndex = shop.editing ? shopIndex : -1;\n    },\n    reduce(good) {\n      if (good.number === 1) return;\n      // axios\n      //   .post(url.reduceCart, {\n      //     id: good.id,\n      //     number: 1\n      //   })\n      //   .then(res => {\n      //     good.number--;\n      //   });\n      Cart.reduce(good.id).then(res=>{\n        good.number--\n      })\n    },\n    add(good) {\n      // axios\n      //   .post(url.addCart, {\n      //     id: good.id,\n      //     number: 1\n      //   })\n      //   .then(res => {\n      //     good.number++;\n      //   });\n      Cart.add(good.id).then(res => {\n        good.number++;\n      });\n    },\n    remove(shop, shopIndex, good, goodIndex) {\n      this.removePopup = true;\n      this.removeData = { shop, shopIndex, good, goodIndex };\n      this.removeMsg = \"你确定要删除此商品吗？\";\n    },\n    removeList() {\n      this.removePopup = true;\n      this.removeMsg = `你确定要删除${this.removeLists.length}个商品吗？`;\n    },\n    removeConfirm() {\n      if (this.removeMsg === \"你确定要删除此商品吗？\") {\n        let { shop, shopIndex, good, goodIndex } = this.removeData;\n        fetch(url.removeCart, {\n            id: good.id\n          })\n          .then(res => {\n            shop.goodsList.splice(goodIndex, 1);\n            this.removePopup = false;\n            if (!shop.goodsList.length) {\n              this.cartlists.splice(shopIndex, 1);\n              this.resetShop();\n            }\n          });\n      } else {\n        let ids = [];\n        this.removeLists.forEach(good => {\n          ids.push(good.id);\n        });\n        // 分为两种状态，正常和编辑，removeLists就是编辑状态下选中的商品，\n        // 删除多个商品，先遍历选中的商品列表，将它们的id放到ids数组\n        // 发请求，根据ids的id，删除对应的商品，\n        // 遍历编辑状态下的商品列表，对比选中的商品，利用findIndex\n        fetch(url.mremoveCart, { ids }).then(res => {\n          let arr = [];\n          this.editingShop.goodsList.forEach(good => {\n            let index = this.removeLists.findIndex(item => {\n              return item.id == good.id;\n            });\n            if (index === -1) {\n              // 剩下的是不用删除的商品，\n              arr.push(good);\n            }\n          });\n          if (arr.length) {\n            // 数组长度不为空，将arr赋值给编辑状态下的shop的商品列表\n            this.editingShop.goodsList = arr;\n          } else {\n            // 数组长度为空，相当于那个店铺的商品都没了，从源数据中删除该商铺\n            this.cartlists.splice(this.editingShopIndex, 1);\n            this.resetShop();\n          }\n          this.removePopup = false;\n        });\n      }\n    },\n    cancel() {\n      this.removePopup = false;\n    },\n    resetShop() {\n      this.editingShop = null;\n      this.editingShopIndex = -1;\n      this.cartlists.forEach(shop => {\n        shop.editing = false;\n        shop.editingMsg = \"编辑\";\n      });\n    }\n  }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cart/cart.js","import axios from \"axios\";\nimport url from 'js/api.js'\n\nfunction fetch(url,data) {\n  return new Promise((resolve,reject)=>{\n    axios.post(url,data).then(res=>{\n      let status = res.data.status\n      if(status === 200){\n        resolve(res)\n      }\n      if(status === 300){\n        location.href = 'login.html'\n        resolve(res)\n      }\n      reject(res)\n    }).catch(error=>{\n      reject(error)\n    })\n  })\n}\n\nexport default fetch\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/fetch.js"],"sourceRoot":""}